/**
 * Chrome styles for widget-based regions and overlays.
 * Used by ChromeRenderer.
 *
 * - Overlay positioning styles for widget-based overlays
 * - Footer styles are imported separately in engine/styles.css (before this file)
 * - Component-based chrome handles its own styles
 *
 * Container-aware:
 * Uses container queries to respond to the site container size (for iframe/preview support).
 * Overlays must be portaled to the site container (not document.body) to maintain
 * container query context.
 *
 * Uses --overlay-position CSS variable to switch between fixed (fullpage)
 * and absolute (contained/preview) positioning.
 */

/* Chrome region wrapper — full-width (like [data-section-id]).
   Semantic wrappers (header, footer, aside) stay full-width for edge-to-edge backgrounds.
   region.style carries backgroundColor etc. via inline styles.
   When constrained, direct children (content widgets) get max-width from site theme. */

/* Constrained chrome regions: opt-in max-width for direct children */
.chrome-region--constrained > * {
  max-width: var(--site-max-width, none);
  margin-left: auto;
  margin-right: auto;
}

/* Base overlay - shared properties */
.chrome-overlay {
  position: var(--overlay-position, fixed);
  z-index: 100;
  pointer-events: auto;
}

/**
 * Color shift blend mode fix (ContactPrompt overlay).
 * Mix-blend-mode must be on the stacking context (fixed + z-index element),
 * not a nested child. Chrome creates isolation when z-index is set.
 *
 * Uses mechanism-based effect name (color-shift) per architecture spec.
 *
 * States:
 * - Default: mix-blend-mode: difference (adapts to background)
 * - Hovered: mix-blend-mode: normal (shows purple CTA color)
 * - Copied: mix-blend-mode: difference (via data-copy-state)
 */
.chrome-overlay:has([data-effect="color-shift"]) {
  mix-blend-mode: difference;
  color: white;
}

/* Hover state: normal blend to show purple */
/* Also set color directly to avoid flash of white before behaviour computes */
/* data-hovered is on BehaviourWrapper parent, data-effect on ContactPrompt child */
.chrome-overlay:has([data-hovered]) {
  mix-blend-mode: normal;
  color: var(--interaction, #9933FF);
}

/* Copied state: back to difference blend */
.chrome-overlay:has([data-effect="color-shift"][data-copy-state]) {
  mix-blend-mode: difference;
}

/* Position variants — max-width aware.
   On ultrawide screens, overlays stay within the content area boundary.
   max() ensures minimum offset when viewport <= max-width. */
.chrome-overlay--top-left {
  top: 24px;
  left: max(24px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 24px));
}

.chrome-overlay--top-right {
  top: 24px;
  right: max(24px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 24px));
}

.chrome-overlay--bottom-left {
  bottom: 24px;
  left: max(24px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 24px));
}

.chrome-overlay--bottom-right {
  bottom: 24px;
  right: max(24px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 24px));
}

/* Desktop: match bojuhl.com reference positioning */
@container site (min-width: 1024px) {
  .chrome-overlay--top-left {
    top: 22px;
    left: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
  }

  .chrome-overlay--top-right {
    top: 22px;
    right: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
  }

  .chrome-overlay--bottom-left {
    bottom: 22px;
    left: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
  }

  .chrome-overlay--bottom-right {
    bottom: 22px;
    right: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
  }
}

/* Fallback for browsers without container query support */
:where([data-breakpoint="desktop"]) .chrome-overlay--top-left {
  top: 22px;
  left: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
}

:where([data-breakpoint="desktop"]) .chrome-overlay--top-right {
  top: 22px;
  right: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
}

:where([data-breakpoint="desktop"]) .chrome-overlay--bottom-left {
  bottom: 22px;
  left: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
}

:where([data-breakpoint="desktop"]) .chrome-overlay--bottom-right {
  bottom: 22px;
  right: max(48px, calc((100vw - var(--site-max-width, 100vw)) / 2 + 48px));
}

/* Mobile: hide overlays */
@container site (max-width: 767px) {
  .chrome-overlay {
    display: none;
  }
}

/* Fallback for browsers without container query support */
:where([data-breakpoint="mobile"]) .chrome-overlay {
  display: none;
}
